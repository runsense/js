<html>
  <head>
  <title>gestion</title>
	<script src="http://code.jquery.com/jquery-3.1.1.min.js"  ></script>
    <script type="text/javascript">
	$.urlParam=function(name){var results=new RegExp('[\?&]'+name+'=([^&#]*)').exec(window.location.href);try{return results[1]||0;}catch(e){return null;}};
    var FuncTab=FuncTab||{};var FuncTab={
	  var CLIENT_ID = '1076803953445-apq2kp8mjcsasv5ipro28idh23kf5rfm.apps.googleusercontent.com';

      var SCOPES = ['https://www.googleapis.com/auth/drive','https://www.googleapis.com/auth/gmail.send'];

      function checkAuth(){gapi.auth.authorize({'client_id': CLIENT_ID,'scope': SCOPES.join(' '),'immediate': false}, handleAuthResult);      }

      function handleAuthResult(authResult){var authorizeDiv=document.getElementById('authorize-div');if(authResult && !authResult.error){
	  var prmt=[$.urlParam('nom')];authorizeDiv.style.display='none';callScriptFunction(prmt);}else{authorizeDiv.style.display='inline';}}

       function handleAuthClick(event){gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES,immediate:false},handleAuthResult);return false;}

       function callScriptFunction(prmt){
        var scriptId = "1Xnlk8R0Pl6-KmbSNLhblOW9sJ4QvmxQHNdC7nB2l9lFKs2QvhA6YhuK1";
        var request = {
            'function': 'fSearch',
			'parameters': [prmt]
            };

        var op = gapi.client.request({
            'root': 'https://script.googleapis.com',
            'path': 'v1/scripts/' + scriptId + ':run',
            'method': 'POST',
            'body': request
        });

        op.execute(function(resp) {
          if (resp.error && resp.error.status) {
            appendPre('Error calling API:');
            appendPre(JSON.stringify(resp, null, 2));
          } else if (resp.error) {
            var error = resp.error.details[0];
            appendPre('Script error message: ' + error.errorMessage);

            if (error.scriptStackTraceElements) {
              appendPre('Script error stacktrace:');
              for (var i = 0; i < error.scriptStackTraceElements.length; i++) {
                var trace = error.scriptStackTraceElements[i];
                appendPre('\t' + trace.function + ':' + trace.lineNumber);
              }
            }
          } else {
            var rslt = resp.response.result;           
              appendPre('error is send \n'+rslt);            
          }
        });
      }
      function appendPre(message){var pre=document.getElementById('output');var textContent=document.createTextNode(message+'\n');pre.appendChild(textContent);}

    </script>
    <script src="https://apis.google.com/js/client.js?onload=checkAuth">
    </script>
  </head>
  <body>
    <div id="authorize-div" style="display: none">
      <span>Authorize access to Google Apps Script Execution API</span>
      <!--Button for the user to click to initiate auth sequence -->
      <button id="authorize-button" onclick="handleAuthClick(event)">
        Authorize
      </button>
    </div>
    <pre id="output"></pre>
  </body>
</html>