/*!
 * Runsense 97Kafr
 *
 * Copyright 2018, Dalleau Pascal
 *
 */
//Objet Librairie Variable
if($('#map_canvas').css('width')==='800px'){bnm=false;}
var FuncInit= FuncInit || {};var FuncInit={/*blockzoom*/anex:[],srcZn:[],srcId:[{label:'',value:'',id:''}],
initSrch:'',bxt:false,ak:'',src:'',zm:10,rvzm:13,bnm:true,initl:'auto',idStab:'',
initInfMsg:['info1','info2','info3'],map:new google.maps.LatLng(-21.137472,55.546906),org_ftl:'1So5MDh-kSSDOudH6iznmgC3DTfn4SBKiilMj27DI',
colormsg:['blue','red','green'],clm_ftl:['id','categ','nom','description','lat','lng'],
idbut_clear:'',iddep:'',idarv:'',idbut_rtr:'',idlieu:'',idthm:'',
idtree:"#jqxTree",idtab:"",idmap:"#map_canvas",idp:"#panel",idinf:"#info",iditi:"",idbtn:"",idsup:"#pano",idrbb:"#r_bdd",bstyle:"http://runsense.github.io/js/f.png",txtInit:[""]/*12*/,tmp:'',
init:function(){$(FuncInit.idStab).change(function (){FuncTree.bms=false;FuncTab.fsearch(this.value);$(FuncInit.idtab).mouseover();});
$(FuncInit.idtab).on("mouseenter",function(){if(FuncInit.bnm){ $(this).animate({opacity: '0.75',height: '100%',width: '70%'});$(FuncInit.idmap).animate({opacity: '0.3'});$(FuncInit.idp).animate({opacity: '0.3'});$('body').animate({height: '100% !important',margin: '0px !important',padding: '0px !important'});}else{$(this).animate({zIndex:'1'});$(FuncInit.idmap).animate({zIndex:'0'});$(FuncInit.idp).animate({zIndex:'0'});}$(FuncInit.idinf).empty();FuncTree.append("<small>&Agrave; r\'tourn Return MAP </small>(A DROITE)","green");$(FuncInit.idinf).bind('click',function(){ if(FuncInit.bnm){$(FuncInit.idtab).animate({opacity: '1',height: '15%',width: '100%'});$(FuncInit.idmap).animate({opacity: '1'});$(FuncInit.idp).animate({opacity: '1'});}else{$(FuncInit.idtab).animate({zIndex:'1'});$(FuncInit.idmap).animate({zIndex:'0'});$(FuncInit.idp).animate({zIndex:'0'});}});});
$(FuncInit.idinf).bind('click',function(){if(FuncInit.bnm){$(FuncInit.idtab).animate({opacity: '0.75',height: '100%',width: '70%'});$(FuncInit.idmap).animate({opacity: '0.3'});$(FuncInit.idp).animate({opacity: '0.3'});}else{$(FuncInit.idtab).animate({zIndex:'1'});$(FuncInit.idmap).animate({zIndex:'0'});$(FuncInit.idp).animate({zIndex:'0'});}});
$(FuncInit.idp).hover(function(){if(FuncInit.bnm){$(FuncInit.idtab).animate({opacity: '1',height: '15%',width: '100%'});$(FuncInit.idmap).animate({opacity: '1'});$(FuncInit.idp).animate({opacity: '1'});}else{$(FuncInit.idtab).animate({zIndex:'1'});$(FuncInit.idmap).animate({zIndex:'0'});$(FuncInit.idp).animate({zIndex:'0'});}});
$(FuncInit.idbut_rtr).click(function(){if(FuncInit.bnm){$(FuncInit.idtab).animate({opacity: '1',height: '15%',width: '100%'});$(FuncInit.idmap).animate({opacity: '1'});$(FuncInit.idp).animate({opacity: '1'});}});
$(FuncInit.idrbb).change(function(){FuncTree.bms=false;FuncTree.bms=false;MapsLib.colSrch="description";MapsLib.srchOnAll(this.value);$(FuncInit.idinf).empty();FuncTab.msg= FuncInit.initInfMsg[0];FuncTree.append(FuncTab.msg,FuncInit.colormsg[1]);});
$(FuncInit.idrbb).mouseleave(function(){FuncTab.crTb();MapsLib.displayList();FuncTab.fshBDD();FuncTab.search='';});
$(FuncInit.idp).focus(function(){FuncTab.crTb();MapsLib.displayList();FuncTab.fshBDD();FuncTab.search='';}).blur(function(){FuncTab.crTb();MapsLib.displayList();FuncTab.fshBDD();FuncTab.search='';});
$(FuncInit.idrbb).click(function(){$(FuncInit.idinf).empty();FuncTab.msg= FuncInit.initInfMsg[1];FuncTree.append(FuncTab.msg,FuncInit.colormsg[0]);});
$(FuncInit.idbtn).bind('click',function(){$(FuncInit.idsup).empty();$(FuncInit.idsup).animate({ width: '0%' });$(FuncInit.idp).animate({left: '70%'});$('small').show();$(FuncInit.idinf).empty();$(FuncInit.iddep).val(null);$(FuncInit.idarv).val(null);$(FuncInit.idtab).show();$(FuncInit.iditi).css('color',FuncInit.colormsg[0]);$(FuncInit.iditi).css('border-color','#FFFF00');$(FuncInit.iditi).css('font-size','15px');$(FuncInit.iditi).css('font-weight','none');MapsLib.s=null;MapsLib.e=null;$(FuncInit.idbtn).hide();MapsLib.initialize();$(FuncInit.idtab).show();});
$(FuncInit.idinf).bind('click',function(){if(FuncInit.bnm){$(FuncInit.idtab).animate({opacity: '1',height: '15%',width: '100%'});$(FuncInit.idmap).animate({opacity: '1'});$(FuncInit.idp).animate({opacity: '1'});}else{$(FuncInit.idtab).animate({zIndex:'1'});$(FuncInit.idmap).animate({zIndex:'0'});$(FuncInit.idp).animate({zIndex:'0'});}});
$(FuncInit.idclear).css('color',FuncInit.colormsg[0]);$(FuncInit.idclear).css('border-color',FuncInit.colormsg[0]);		
$(FuncInit.idclear).bind('click',function(){MapsLib.map_centroid = FuncInit.map;FuncTree.zoom=10;MapsLib.doSearch();var items = $(FuncInit.idtree).jqxTree('getCheckedItems');for(var i in items){var e=items[i].element;$(FuncInit.idtree).jqxTree('uncheckItem', e);$(FuncInit.idtree).jqxTree('collapseItem', e);}$(FuncInit.idtree).jqxTree('refresh');});
$(FuncInit.iddep).click(function(){MapsLib.chad=FuncInit.iddep; return true;});
$(FuncInit.idarv).click(function(){MapsLib.chad=FuncInit.idarv; return true;});
$(FuncInit.idmap).mouseleave(function(){if(map.getMapTypeId()===google.maps.MapTypeId.ROADMAP) map.setMapTypeId(google.maps.MapTypeId.HYBRID);else if(map.getMapTypeId()===google.maps.MapTypeId.HYBRID) map.setMapTypeId(google.maps.MapTypeId.SATELLITE);else map.setMapTypeId(google.maps.MapTypeId.ROADMAP); if(map.getZoom===FuncTree.rvzoom) map.setZoom(FuncInit.rvzm);else map.setZoom(FuncTree.rvzoom);FuncRoute.calcRoute();return true;});
$(FuncInit.iditi).click(function(){FuncRoute.calcRoute();return true;});
/*NO for external call*/if(!FuncInit.bxt){$( FuncInit.idthm ).selectBox({mobile:true}).change(function(){FuncTree.bms=false;var bzn=false;var zns =FuncInit.srcZn;for(var z in zns) {if(zns[z]==FuncInit.tmp) bzn= true;}if(bzn){MapsLib.srchOnAll(this.value);$(FuncInit.idinf).empty();FuncTab.msg= FuncInit.initInfMsg[2];FuncTree.append(FuncTab.msg,FuncInit.colormsg[1]);} else{var ids = FuncInit.srcId;var rplc='#'+FuncInit.tmp+'_';rplc = rplc+$(this).val();if(FuncInit.bnm) $(FuncInit.idtree).jqxTree('selectItem',$(rplc)[0]);else FuncTree.applyMob(rplc);}});$(FuncInit.idlieu).selectBox({mobile:true}).change(function(){FuncTree.bms=false;FuncInit.tmp=$(this).val();$( FuncInit.idthm ).selectBox('value',"general");var rplc ='#'+FuncInit.tmp;$(FuncInit.idtree).jqxTree('selectItem',$(rplc)[0]);});}else{$( FuncInit.idlieu ).empty();$( FuncInit.idlieu ).html(FuncInit.initSrch);$( FuncInit.idthm ).empty();}}};

/*Objet creation tableau de r√©ponse json*/var FuncTab=FuncTab || {};var FuncTab={bmrk:false,results:null,idx:0,search:"",list_table:"",lat:null,lng:null,msg:"",
fsearch:function(s){var rplc ='#'+s.replace(/ /g,'').replace(/'/g,'');var table= $("#list_table").dataTable();table.fnFilter(s);$(rplc).mouseover();},
displayList: function(json) {try{MapsLib.handleError(json);}catch( e){ ;}var columns = json["columns"];var rows = json["rows"];var rplc="#"+MapsLib.cpte;FuncTab.results = $(rplc);FuncTab.results .empty();if (rows ===null) FuncTab.results.append("<span class='lead'>No results found</span>"); else{FuncTab.crTb();FuncTab.cRows(rows);FuncTab.fnsTb();}},
crTb:function(){var rplc="#"+0;FuncTab.results=$(rplc);FuncTab.results.empty();FuncTab.list_table="<table class='table' id ='list_table'><tbody>";},
fshBDD:function(){FuncTab.list_table += "</tbody></table>";if(FuncTab.lat!=""&&FuncTab.lng!=""){MapsLib.map_centroid=new google.maps.LatLng(FuncTab.lat,FuncTab.lng);map.setCenter(MapsLib.map_centroid);}FuncTab.results.append(FuncTab.list_table);$("#list_table").dataTable({"aoColumns":[null,null,null,null,null,null],"sDom": '<"top"pf>rt<"bottom"lip><"clear">',"bFilter": true,"bInfo": true,"scrollY":"450px","scrollCollapse": true,"paging":true,"bAutoWidth": false});$(".table tbody").on('click','tr',function(){if(!FuncTree.bchk){MapsLib.addSrchMarker.setMap(null);var lat=$(this).children('td:nth-child(4)').text();var lng = $(this).children('td:nth-child(5)').text();var nm = '#'+$(this).children('td:nth-child(6)').text();FuncTab.tabToMap(lat,lng);$(FuncInit.idtree).jqxTree('selectItem', $(nm)[0]);$(FuncInit.idtree).jqxTree('expandItem', $(nm)[0]);$(FuncInit.idmap).focus();FuncTree.zoom=13;FuncInit.bnm=true;}}).on( 'mouseover','tr',function(){$(this).css("background","#0404B4");}).on('mouseleave','tr',function(){$(this).css("background","");}).on( 'mouseover', 'td', function (){$(this).css("background","#B8860B");$(this).css("fontSize","180%");}).on('mouseleave','td',function(){$(this).css("background","");$(this).css("fontSize","100%");});},
fnsTb:function(){FuncTab.list_table += "</tbody></table>";if(FuncTab.lat!=""&&FuncTab.lng!=""){MapsLib.map_centroid= new google.maps.LatLng(FuncTab.lat,FuncTab.lng);map.setCenter(MapsLib.map_centroid);}FuncTab.results.append(FuncTab.list_table);$("#list_table").dataTable({"aoColumns": [null,null,null,null,null,null,null],"sDom":'<"top"pf>rt<"bottom"lip><"clear">',"oSearch":{"sSearch":FuncTab.search},"bFilter":true,"bInfo":true,"scrollY":"450px","scrollCollapse": true,"paging":true,"bAutoWidth": false});$(".table tbody").on('click','tr',function(){if(!FuncTree.bchk){MapsLib.addSrchMarker.setMap(null);FuncTree.bchk=true;var nm=$(this).children('td:nth-child(2)').text().replace(/ /g,'');var lat=$(this).children('td:nth-child(5)').text();var lng=$(this).children('td:nth-child(6)').text();var idref=$(this).children('td:nth-child(7)').text();var ids=FuncInit.srcId;for(var id in ids) if(ids[id].label===nm){FuncTab.bmrk=true;nm ='#'+idref;}if(!FuncTab.bmrk){ids = FuncInit.srcZn; for(var id in ids) if(ids[id]===nm) FuncTab.bmrk=true;nm ='#'+nm;};FuncTab.tabToMap(lat,lng);FuncTab.bmrk=false;$(FuncInit.idtree).jqxTree('selectItem',$(nm)[0]);FuncTree.bchk=false;$(FuncInit.idmap).focus();}}).on('mouseover','tr',function(){$(this).css("background","#0404B4");}).on('mouseleave','tr',function(){$(this).css("background","");}).on('mouseover','td',function(){$(this).css("background","#B8860B");$(this).css("fontSize","180%");}).on( 'mouseleave','td',function(){$(this).css("background","");$(this).css("fontSize","100%");});},
cRows:function(rows) {for (var row in rows) {var ctg = rows[row][0];var nom = rows[row][1];var desc = rows[row][2];FuncTab.lat = rows[row][3];FuncTab.lng = rows[row][4];if(ctg.split("http:").length===1) {var spl=ctg.split("*");var lg=spl.length;if(lg===1) {ctg="<img src='http://runsense.github.io/js/img/ico/"+ctg+".png' style='width: 30px;height: 30px'></img>"; }else{ctg='';for(var i in spl) ctg=ctg+"<img src='http://runsense.github.io/js/img/ico/"+spl[i]+".png' style='width: 15px;height: 30px'></img>";}}else ctg="<img src='"+ctg+"' style='width: 30px;height: 30px'></img>";FuncTab.list_table += "<tr id="+nom.replace(/ /g,'').replace(/'/g,'')+"><td >" +ctg + "</td><td >" + nom + "</td><td >" + desc + "</td><td >" +ctg + "</td><td style='color:blue;width:20px;' >" + FuncTab.lat + "</td><td style='color:blue;width:20px;' >" + FuncTab.lng + "</td><td style='visibility:hidden;' >"+rows[row][5]+ "</td></tr>";}},
tabToMap: function(lat,lng){if(lat>-22){if(lng<55.8){MapsLib.map_centroid = new google.maps.LatLng(lat,lng);map.setCenter(MapsLib.map_centroid);if(FuncTree.zoom!=10) FuncTree.zoom=16;map.setMapTypeId(google.maps.MapTypeId.ROADMAP);map.setZoom(FuncTree.zoom);if(FuncInit.bnm){$(FuncInit.idtab).animate({opacity:'0.3', height:'30%'});$(FuncInit.idmap).animate({opacity: '1' });}else{$(FuncInit.idtab).animate({zIndex:'0'});$(FuncInit.idmap).animate({zIndex:'1'});$(FuncInit.idp).animate({zIndex:'1'});}MapsLib.chad=FuncInit.idarv;MapsLib.addrFromLatLng(MapsLib.map_centroid);if(!FuncTab.bmrk){var ad=$(MapsLib.chad).val();MapsLib.addSrchMarker = new google.maps.Marker({position: MapsLib.map_centroid,map: map,animation: google.maps.Animation.DROP,title:ad});}}}}}

//Objet Itin√©raire Google
var FuncRoute=FuncRoute || {};var FuncRoute={directionsDisplay:new google.maps.DirectionsRenderer(),directionsService:new google.maps.DirectionsService(),
calcRoute:function(){$(FuncInit.idinf).empty();$(FuncInit.idinf).show();if(MapsLib.e!==null){var request={origin:MapsLib.s,destination:MapsLib.e,travelMode: google.maps.TravelMode.DRIVING};FuncRoute.directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){FuncRoute.directionsDisplay.setDirections(response);MapsLib.zoom(map);$(FuncInit.idinf).empty();FuncRoute.directionsDisplay.setPanel(document.getElementById('pano'));$('small').hide();$(FuncInit.idsup).animate({ width: '35%'});$(FuncInit.idp).animate({left: '100%' });$(FuncInit.idtab).hide();$(FuncInit.idbtn).show();}else{$(FuncInit.idinf).empty();$(FuncInit.idinf).append("<h1>Y GAGN PA t&EGRAVE;r l&AGRAVE!!(UNKNOW ADRESSE)</h1>");$(FuncInit.idinf).css("color","#000");$(FuncInit.idinf).css("background-color","red");}});MapsLib.doSearch();}}};

//objet Arbre  
var FuncTree=FuncTree || {};var FuncTree={bchk:false,bgrow:false,bms:true,ptbid:[FuncInit.org_ftl],styles:["",FuncInit.bstyle],zoom:10,rvzoom:11,
theme:[{label:'general',value:''},{label:FuncInit.txtInit[0],value:'t'},{label:FuncInit.txtInit[1],value:'s'},{label:FuncInit.txtInit[2],value:'md'},{label:FuncInit.txtInit[3],value:'v'},{label:FuncInit.txtInit[4],value:'n'},{label:FuncInit.txtInit[5],value:'a'}],
srcStyle:[{label: FuncInit.txtInit[0],value: "play"},{label: FuncInit.txtInit[1],value: "hiker"},{label: FuncInit.txtInit[2],value: "dining"},{label: FuncInit.txtInit[3],value: "realestate"},{label: FuncInit.txtInit[4],value: "star"},{label: FuncInit.txtInit[5],value: "ranger_station"},{label: "EST",value: "#DAA520",lien:FuncInit.txtInit[6]+"Est.png"},{label: "Bras-Panon",value: "#4B0082",lien:FuncInit.txtInit[6]+"brasPanon.png" },{label: "Saint-Andre",value: "#006400",lien:FuncInit.txtInit[6]+"saintAndre.png"},{label: "Saint-Benoit",value: "#008B8B",lien:FuncInit.txtInit[6]+"saintBenoit.png"},{label: "Sainte-Anne",value: "#800000",lien:FuncInit.txtInit[6]+"sainteAnne.png"},{label: "Sainte-Rose",value: "#DAA520",lien:"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Sainte-Rose_eglise.jpg/800px-Sainte-Rose_eglise.jpg"},{label: "La Plaine Des Palmistes",value: "#CD5C5C",lien:"https://upload.wikimedia.org/wikipedia/commons/b/b3/Ppalmistes2.jpg"},{label: "Salazie",value: "#000080",lien:"http://www.transeet.fr/wp-content/uploads/2013/05/Ile-de-la-Reunion-510x350.jpg"},{label:"OUEST", value:" #CD5C5C",lien:FuncInit.txtInit[6]+"Ouest.png"},{label: "Mafate",value: "#4B0082",lien:FuncInit.txtInit[6]+"mafate.png"},{label: "Saint-Gilles",value: "#006400",lien:FuncInit.txtInit[6]+"saintGilles.png"},{label: "Saint-Leu",value: "#008B8B",lien:FuncInit.txtInit[6]+"saintLeu.png"},{label: "Trois Bassins",value: "#800000",lien:FuncInit.txtInit[6]+"troisBassins.png"},{label: "Saint-Paul",value: "#DAA520",lien:FuncInit.txtInit[6]+"saintPaul.png"},{label: "Etang Sale",value: "#CD5C5C",lien:FuncInit.txtInit[6]+"etangSale.png"},{label: "Entre-Deux",value: "#000080",lien:FuncInit.txtInit[6]+"entreDeux.png"},{label: "Les Avirons",value: "#FFD700",lien:FuncInit.txtInit[6]+"lesAvirons.png"},{label: "SUD",value:"#66CDAA",lien:FuncInit.txtInit[6]+"sud.png"},{label: "Saint-Pierre",value: "#4B0082",lien:FuncInit.txtInit[6]+"saintPierre.png"},{label: "Saint-Joseph",value: "#006400",lien:FuncInit.txtInit[6]+"saintJoseph.png"},{label: "Petite Ile",value: "#008B8B",lien:"https://upload.wikimedia.org/wikipedia/commons/1/11/Reunion_PetiteIle.JPG"},{label: "Saint-Louis",value: "#800000",lien:"https://upload.wikimedia.org/wikipedia/commons/e/e1/R%C3%A9union_LesMakes.JPG"},{label: "Cilaos",value: "#DAA520",lien:"https://upload.wikimedia.org/wikipedia/commons/4/43/Cirque_De_Cilaos_On_Reunion.jpg"},{label: "Tampon",value: "#CD5C5C",lien:FuncInit.txtInit[6]+"tampon.png"},{label: "La Plaine Des Cafres",value: "#000080",lien:FuncInit.txtInit[6]+"laPlaineDesCafres.png"},{label: "enclos du Tremblet",value: "#FFD700",lien:"https://upload.wikimedia.org/wikipedia/commons/3/37/Piton_de_la_Fournaise%2C_R%C3%A9union_Island_%28High_Resolution%29.jpg"},{label: "Saint-Phillippe",value: "#66CDAA",lien:FuncInit.txtInit[6]+"saintPhillippe.png"},{label: "NORD",value: "#4169E1",lien:FuncInit.txtInit[6]+"rocheEcrite.png"},{label: "Saint-Denis",value: "#4B0082",lien: "https://upload.wikimedia.org/wikipedia/commons/b/b9/SaintDenisReunion003.jpg"},{label: "Sainte-Marie",value: "#006400",lien:FuncInit.txtInit[6]+"sainteMarie.png"},{label: "Sainte-Suzanne",value: "#008B8B",lien:FuncInit.txtInit[6]+"sainteSuzanne.png"},{label: "La Possession",value: "#800000",lien:FuncInit.txtInit[6]+"laPossession.png"},{label: "Le Port",value: "#DAA520",lien:FuncInit.txtInit[6]+"lePort.png"}
,{label:FuncInit.anex[0],value:"#3300CC",lien:FuncInit.txtInit[6]+"trail.png"},{label:FuncInit.anex[1],value:"poi"},{label:FuncInit.anex[2],value:"poi"},{label:FuncInit.anex[3],value:"poi"}],
applyChild:function(items){ for(var i in items) FuncTree.chkItm(items[i]);},
chkItm:function(elmt){ var rplc='#'+elmt.id; $(FuncInit.idtree).jqxTree('checkItem', $(rplc)[0], true);},
slcItm:function(txt){ var rplc='#'+txt; return $(FuncInit.idtree).jqxTree('selectItem', $(rplc)[0], true);},
applysrch:function(i){var tmp=FuncTree.ptbid;var stmp=FuncTree.styles;FuncTree.ptbid=new Array();FuncTree.styles=new Array();try{FuncTree.ptbid.push(i.value);FuncTree.styles.push(FuncTree.chStyle(i.label));var u=FuncTree.chURL(i.label);if(u!=null) FuncTree.styles.push(FuncTree.chURL(i.label));else FuncTree.styles.push(FuncInit.bstyle);}catch(e){ FuncTree.ptbid=tmp;FuncTree.styles=stmp;}},
applyMob:function(rplc){var tmp=FuncTree.ptbid;var stmp=FuncTree.styles;FuncTree.ptbid=new Array();FuncTree.styles=new Array();try{rplc=rplc.replace(/#/g,'');var src=FuncTree.src;for(var c in src) if(src[c].id==rplc){var i=src[c];i.html=i.html.split('>')[1].split('<')[0];FuncTree.ptbid.push(i.value);FuncTree.styles.push(FuncTree.chStyle(i.html));var u=FuncTree.chURL(i.html);if(u!=null) FuncTree.styles.push(FuncTree.chURL(i.html));else FuncTree.styles.push(FuncInit.bstyle);}}catch(e){ FuncTree.ptbid=tmp;FuncTree.styles=stmp;}MapsLib.doSearch();},chStyle:function(l) { for(var i=0; i<FuncTree.srcStyle.length;i++) if(FuncTree.srcStyle[i].label===l) return FuncTree.srcStyle[i].value;},
chURL:function(l){for(var i=0; i<FuncTree.srcStyle.length;i++) if(FuncTree.srcStyle[i].label===l) return FuncTree.srcStyle[i].lien;},
append:function(txt,color){$(FuncInit.idinf).append(txt);$(FuncInit.idinf).css("color","white");$(FuncInit.idinf).css("background-color",color);},
selectBox:function(i){if(i.id.match('_')===null){var itmid=i.id;FuncInit.tmp='';$(FuncInit.idlieu).selectBox('value',itmid);var zns = FuncInit.srcZn;for(var z in zns){ if(zns[z]==itmid) FuncInit.tmp=itmid;}if(FuncInit.tmp==='') {var ids = FuncInit.srcId; for(var id in ids) if(ids[id].label===itmid) FuncInit.tmp=ids[id].id;}if(FuncInit.tmp=='') FuncInit.tmp=itmid.split('_')[0]; FuncTree.bms=true;}else { var slc=i.id.split('_')[1]; $(FuncInit.idthm).selectBox('value',slc);FuncTree.bms=false;}},
init:function(){$(FuncInit.idtree).jqxTree({checkboxes:true,source:FuncInit.src,width:'100%',height:FuncTree.initl,theme:'summer'});$('#jqxTree .jqx-tree-item').mouseenter(function (event){event.stopPropagation();var text = event.target.textContent;var i;if(FuncInit.bnm&&FuncTree.bms)try{text = text.replace(/ /g,'').replace(/'/g,'');rplc = '#'+text;i = $(FuncInit.idtree).jqxTree('getItem',$(rplc)[0]);$(FuncInit.idlieu).val(text);}catch(e){for(var j in FuncTree.theme){var rplc=FuncTree.theme[j].label.replace(/ /g,'').replace(/'/g,'');if(rplc===text) {var slval=FuncTree.theme[j].value;var id='#'+FuncInit.tmp+'_'+slval;i=$(FuncInit.idtree).jqxTree('getItem',$(id)[0]);$(FuncInit.idthm).val(slval);}}}finally{FuncTree.applysrch(i);MapsLib.doSearch();}});$(FuncInit.idtree).on('expand', function(ev) {if(FuncInit.bnm){var e = ev.args.element;var i = $(FuncInit.idtree).jqxTree('getItem',e );if($(FuncInit.idtree).jqxTree('getItem',e.parentElement.parentElement)!=null) FuncTree.zoom=12; else FuncTree.zoom=10;if(!FuncTree.bgrow){FuncTree.selectBox(i);FuncTree.bgrow=true;$(FuncInit.idtree).jqxTree('checkItem', e, true);$('small').show();FuncTree.applysrch(i);MapsLib.doSearch();$(FuncInit.idtree).jqxTree('ensureVisible', e);}}});$(FuncInit.idtree).on('collapse', function(ev){FuncTree.bms=true; if(!FuncTree.bgrow){FuncTree.bgrow=true;FuncTree.ptbid=new Array();$(FuncInit.idtab).empty();FuncTree.applysrch(null);$('small').hide();FuncTree.zoom=10;MapsLib.doSearch();}});$(FuncInit.idtree).bind('select', function(ev){ev.stopPropagation();FuncTree.zoom=FuncInit.rvzm;var a = ev.args;var e = a.element;if($(e).find("li").length>1) FuncTree.bms=true;var i=$(FuncInit.idtree).jqxTree('getItem', e);if(i!=null){FuncTree.selectBox(i);for(var cpt in FuncInit.txtInit) if(FuncInit.txtInit[cpt]===i.label) {FuncTree.bgrow=true;} $(FuncInit.idtree).jqxTree('checkItem', e, true); FuncTree.applysrch(i); MapsLib.doSearch();}});$(FuncInit.idtree).on('checkChange', function (ev){if(!FuncTree.bgrow){$(FuncInit.idclear).css('color',FuncInit.colormsg[1]);$(FuncInit.idclear).css('border-color',FuncInit.colormsg[2]);var a = ev.args;var e = a.element;var item = $(FuncInit.idtree).jqxTree('getItem', e);var bIn=false;for(var i in FuncInit.txtInit){if(item.label===FuncInit.txtInit[i]) bIn=true;}if(!bIn){FuncInit.tmp=item.label;var items=$(FuncInit.idtree).jqxTree('getCheckedItems');var pre = e.parentElement.parentElement;var	prei = $(FuncInit.idtree).jqxTree('getItem', pre);if(prei!=null)for(var i in items){if(items[i].element!=pre&&items[i].element!=e) { $(FuncInit.idtree).jqxTree('uncheckItem', items[i].element); }}}FuncTree.bgrow=true;if(a.checked){ $(FuncInit.idtree).jqxTree('expandItem', e);}else {$(FuncInit.idtree).jqxTree('collapseItem', e);}}else{$(FuncInit.idclear).css('font-weight','bold');$(FuncInit.idclear).css('font-size','18px');}});}};

google.maps.visualRefresh = true;

//Objet Librairie de Google Map
var MapsLib = MapsLib || {};var MapsLib={colSrch:'description',s:null,e:null,cpte:0,chad:'',datajson:['',''],geocoder:new google.maps.Geocoder(),polygonTableID:[],polygon:new Array(),googleApiKey:FuncInit.ak,locationColumn	:"lat",map_centroid:FuncInit.map,locationScope:"reunion",defaultZoom:FuncInit.zm,row:[],addSrchMarker:new google.maps.Marker(),h:34,p:10,
strVw:new google.maps.StreetViewPanorama(document.getElementById("strvw"),{position: MapsLib.map_centroid,pov:{heading:34,pitch:10}}),
initialize:function(){try{MapsLib.geocoder = new google.maps.Geocoder();FuncRoute.directionsDisplay = new google.maps.DirectionsRenderer();}catch(e){;}var myOptions={zoom: MapsLib.defaultZoom, center: MapsLib.map_centroid, mapTypeId: google.maps.MapTypeId.ROADMAP,styleId:2,templateId:1 };map = new google.maps.Map($("#map_canvas")[0],myOptions);/*Streetview*/MapsLib.strVw=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position: MapsLib.map_centroid,pov:{heading:34,pitch:10}});/*Streetview*/map.setStreetView(MapsLib.strVw);google.maps.event.addListener(map, "click",function(event) { MapsLib.clickmap(event); });google.maps.event.addDomListener(window,'resize',function(){map.setCenter(MapsLib.map_centroid); map.setZoom(FuncTree.zoom);});try{FuncRoute.directionsDisplay.setMap(map); }catch(e){;}google.maps.event.addListener(map, 'mouseover', function(event){FuncTree.rvzoom=map.getZoom();map.setZoom(FuncTree.zoom);});MapsLib.doSearch();if(FuncInit.initSrch!=''){MapsLib.colSrch=FuncInit.clm_ftl[1];var srch=FuncInit.initSrch;FuncTree.bms=false;$(FuncInit.idlieu).val(FuncInit.initl);$(FuncInit.idthm).val(FuncInit.initt);$(FuncInit.idrbb).val(srch);MapsLib.srchOnAll(srch);$(FuncInit.idrbb).focus();$(FuncInit.idrbb).mouseenter();$(FuncInit.idinf).empty();FuncTree.append('PLAY WITH MOUSE for search go top right and left down!!Y GAGN ZOUER POU FE LE RECHERCHE EN HAUT A DROITE EN BAS A GAUCHE','#660066');}},
doSearch:function(location){FuncTree.bgrow = false;MapsLib.clearSearch();MapsLib.polygonTableID=FuncTree.ptbid;MapsLib.polygon=new Array();
try{
var tl=MapsLib.polygonTableID.length;map.setMapTypeId(google.maps.MapTypeId.SATELLITE);
for(var i=0; i<tl; i++){
var stl= FuncTree.styles[i];if(stl=="dining"||stl=="star") map.setMapTypeId(google.maps.MapTypeId.HYBRID);var layer = new google.maps.FusionTablesLayer({query: {from:MapsLib.polygonTableID[i],select: "geometry"},styles:[{markerOptions: {iconName: stl,},polygonOptions: {fillColor: stl,strokeColor: "#FFFFF0",strokeWeight: "int"},polylineOptions: {strokeColor: stl,strokeWeight:"int"}},]});
try{var chcmp=FuncTree.styles[i+1];if(chcmp.charAt(0)!='#'&&chcmp!='NO') {
if(stl.charAt(0)!='#') $(FuncInit.idp).css('border-color',stl);FuncTree.styles=new Array();}}
finally{google.maps.event.addListener(layer, 'click', function(e){ MapsLib.anLayer(e);});MapsLib.polygon.push(layer);MapsLib.polygon[i].setMap(map);}
}}catch(e){;}finally{MapsLib.getList();$(FuncInit.idmap).focus();var anex=FuncInit.anex;for(var a in anex) if(FuncInit.tmp===anex[a]) map.setZoom(10);}},
anLayer:function(e){if(!FuncTree.bchk&&!FuncTree.bgrow){var s= e.infoWindowHtml.split('<b>'+FuncInit.clm_ftl[1]+':</b> ')[1].split('<br>')[0];FuncTree.bchk=true;FuncTab.fsearch(s);var rplc ='#'+s.replace(/ /g,'').replace(/'/g,'');console.log(rplc);$(FuncInit.idtree).jqxTree('selectItem',$(rplc)[0]);MapsLib.chad=FuncInit.idarv; MapsLib.addrFromLatLng(e.latLng);FuncTree.bchk=false;return s;}},
findMe: function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){fl=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);MapsLib.chad= FuncInit.iddep;MapsLib.addrFromLatLng(fl);map.setCenter(fl);}, null);}else FuncTree.append('Lo l\'action fo config!!Configurate your Position',FuncInit.colormsg[1]);},
getSearch:function(value){var callback= "MapsLib.addrow";var slcCol = FuncInit.clm_ftl[1]+','+FuncInit.clm_ftl[3]+','+FuncInit.clm_ftl[4]+','+FuncInit.clm_ftl[5]+','+FuncInit.clm_ftl[2]+','+FuncInit.clm_ftl[0];var queryStr = []; queryStr.push("SELECT " + slcCol); queryStr.push(" FROM " +value);queryStr.push(" WHERE "+MapsLib.colSrch+" CONTAINS '"+FuncTab.search+"' ");var sql = encodeURIComponent(queryStr.join(" "));$.ajax({url: "https://www.googleapis.com/fusiontables/v1/query?sql="+sql+"&callback="+callback+"&key="+MapsLib.googleApiKey, dataType: "jsonp"});},
query:function(slcCol, limit, callback){for(var i in MapsLib.polygonTableID){if(MapsLib.polygonTableID[i]!="NO"){MapsLib.cpte=i; $(FuncInit.idtab).append("<div title='Revenir MAP A DROITE(View MAP RIGHT)' id="+i+" style='background-color: #FFFFFF;'/>");var queryStr = []; queryStr.push("SELECT " + slcCol); queryStr.push(" FROM " + MapsLib.polygonTableID[i]);var sql = encodeURIComponent(queryStr.join(" ")); $.ajax({url: "https://www.googleapis.com/fusiontables/v1/query?sql="+sql+"&callback="+callback+"&key="+MapsLib.googleApiKey, dataType: "jsonp"});}else { $(FuncInit.idtab).empty(); $(FuncInit.idtab).append("<div  id="+i+" style='background-color: #FF0000;>NO DATA</div>");}}$(FuncInit.idinf).empty(); FuncTree.append("D\'scend en bas po&ugrave; l&egrave;v lo l'act </br> (GO ON TRANSPARENT  left down panel)","blue");},
addrFromLatLng: function(latLngPoint){/*Sortie lat long console*/console.log(latLngPoint);MapsLib.geocoder.geocode({'latLng': latLngPoint}, function(results, status){if(status===google.maps.GeocoderStatus.OK){if(results.length>1)$(MapsLib.chad).val(results[0].formatted_address.split(',')[0]+','+results[1].formatted_address); else $(MapsLib.chad).val(results[0].formatted_address);if(MapsLib.chad==FuncInit.iddep){MapsLib.s=results[0].formatted_address;$(FuncInit.iditi).css('font-size','20px');$(FuncInit.iditi).css('font-weight','bold');}else{MapsLib.e=results[0].formatted_address;$(FuncInit.iditi).css('color',FuncInit.colormsg[1]);$(FuncInit.iditi).css('border-color',FuncInit.colormsg[2]);}}});},
zoom: function(map) { var bounds = new google.maps.LatLngBounds(); map.data.forEach(function(feature) { MapsLib.processPoints(feature.getGeometry(), bounds.extend, bounds); }); map.fitBounds(bounds);},
processPoints: function(geometry, callback, thisArg){if(geometry instanceof google.maps.LatLng)callback.call(thisArg, geometry); else if(geometry instanceof google.maps.Data.Point) callback.call(thisArg, geometry.get()); else {geometry.getArray().forEach(function(g) {MapsLib.processPoints(g, callback, thisArg);});}},
clickmap: function(pos){if(pos!=null) MapsLib.addrFromLatLng(pos.latLng); map.setMapTypeId(google.maps.MapTypeId.HYBRID);},
clearSearch: function() {MapsLib.row=[];MapsLib.polygonTableID=null;for(var i=0;i<MapsLib.polygon.length;i++) if(MapsLib.polygon[i] != null){MapsLib.polygon[i].setMap(null); MapsLib.polygon[i]=null; } map.setCenter(MapsLib.map_centroid); map.setZoom(FuncTree.zoom);},
getList:function() { var slcCol = FuncInit.clm_ftl[2]+','+FuncInit.clm_ftl[1]+','+FuncInit.clm_ftl[3]+','+FuncInit.clm_ftl[4]+','+FuncInit.clm_ftl[5]+','+FuncInit.clm_ftl[0]; MapsLib.query(slcCol, 10, "FuncTab.displayList");},
srchOnAll:function(txt){MapsLib.colSrch="description";var th= $( FuncInit.idthm ).val();var li= $(FuncInit.idlieu).val();if(txt!='')try{FuncTab.search=txt;MapsLib.row=[];MapsLib.cpte= 0;var fsrc= FuncInit.src;var bsrc=true;FuncTab.crTb();var ssrcMap;for(var i in fsrc) if(bsrc){var src= fsrc[i];var items= src.items;for(var j in items){if(bsrc){var srcMap=items[j];if(srcMap.id==li) bsrc=false;var ssimts= items[j].items;for(var k in ssimts) {var ssrcMap=ssimts[k];var spl= ssrcMap.id.split('_')[1];if(th!=''){if(spl==th) {MapsLib.getSearch(ssrcMap.value);}}else MapsLib.getSearch(ssrcMap.value);}}} if(src.id==li) bsrc=false;}}finally{MapsLib.displayList();FuncTab.fshBDD();MapsLib.cpte= 0;}},
addrow:function(json){try{MapsLib.handleError(json);}catch(e){;}try{var rows = json["rows"];for(var r in rows)if(rows[r]!=undefined){var rg=[rows[r][4],rows[r][0],rows[r][1],rows[r][2],rows[r][3],rows[r][5]];MapsLib.row.push(rg);}}finally{$(FuncInit.idtab).fadeIn('fast');}},
displayList:function(){MapsLib.cpte=0;for (var row in MapsLib.row)try{var ctg=MapsLib.row[row][0];if(ctg.split("http:").length===1){var spl=ctg.split("*");var lg=spl.length;if(lg===1){ctg="<img src='http://runsense.github.io/js/img/ico/"+ctg+".png' style='width: 30px;height: 30px'></img>";}else{ctg='';for(var i in spl) ctg=ctg+"<img src='http://runsense.github.io/js/img/ico/"+spl[i]+".png' style='width: 15px;height: 30px'></img>";}}else ctg="<img src='"+ctg+"' style='width: 30px;height: 30px'></img>";FuncTab.lat=MapsLib.row[row][3];FuncTab.lng=MapsLib.row[row][4];FuncTab.list_table += "<tr ><td> "+ctg+"</td><td >" + MapsLib.row[row][1] + "</td><td >" + MapsLib.row[row][2] + "</td><td   style='color:blue;width:20px;' >" + MapsLib.row[row][3] + "</td><td   style='color:blue;width:20px;' >" + MapsLib.row[row][4] + "</td><td   style='visibility:hidden;' >" + MapsLib.row[row][5] + "</td></tr>";}catch(e){;}},
handleError:function(json) { if (json["error"] != undefined){var error = json["error"]["errors"];console.log("Error in Fusion Table call!");for (var row in error) { console.log(" Domain: " + error[row]["domain"]);console.log(" Reason: " + error[row]["reason"]);console.log(" Message: " + error[row]["message"]);}}}};



